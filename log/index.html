<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link
            rel="stylesheet"
            href="./model/prism.css"
    />
    <style>
        .log-display {
            width: 100%;
            min-height: 30px; /* 根据需要设置最小高度 */
            overflow: auto; /* 如果内容超出，显示滚动条 */
            margin: 10px 0;
            font-family: monospace;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: white;
            position: relative;
            box-sizing: border-box;
        }

        .log-display pre {
            display: block; /* 确保 pre 是块级元素 */
            margin: 0; /* 移除默认外边距 */
            /*padding: 10px; !* 添加内边距 *!*/
            /*white-space: pre-wrap; !* 允许代码换行 *!*/
            /*word-wrap: break-word; !* 长单词也能换行 *!*/
            border: none; /* 移除 pre 默认的边框 */
            border-radius: 0; /* 移除 pre 默认的圆角，与外层容器保持一致 */
            box-sizing: border-box;
        }

        .log-display code {
            display: block;
            padding: 0;
            height: auto; /* 根据内容自动调整高度 */
            /*white-space: pre-wrap; !* 允许代码换行 *!*/
            box-sizing: border-box;
        }
        .highlight {
            background-color: yellow;
            /* 高亮区域样式 */
        }
    </style>
</head>

<body>

<div class="log-display" id="logDisplay">
    <pre contenteditable="true"><code class="language-java"><br></code></pre>
</div>

<script src="./model/prism.js"></script>
<script src="./model/prism-java.js"></script>
<script>
    let logDisplay = document.getElementById("logDisplay");
    let code = logDisplay.querySelector("code");
    let pre = logDisplay.querySelector("pre");

    utools.onPluginEnter(({utoolsCode, type, payload, option}) => {
        if(type === 'over'){
            code.textContent = payload
        }
        Prism.highlightAll()
    })

    // 监听 paste 事件，以便在粘贴后立即重新高亮
    pre.addEventListener("paste", function(event) {
        // 阻止默认粘贴行为，以便我们可以获取粘贴的文本
        event.preventDefault();
        // 将粘贴的文本设置到 code 元素中
        code.textContent  = (event.clipboardData || window.clipboardData).getData('text/plain');

        Prism.highlightAll()
    });

    // 监听失去焦点事件，以便在内容变化后重新高亮
    pre.addEventListener("blur", function () {
        Prism.highlightAll()
    });

    // 当内容被清空时，阻止进一步的删除操作
    pre.addEventListener('keydown', function(event) {
        if (event.key === 'Backspace' || event.key === 'Delete') {
            if (code.textContent.trim() === '') {
                event.preventDefault();
            }
        }
    });
</script>
</body>
</html>
